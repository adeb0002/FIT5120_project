<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>EcoInsight Melbourne</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Fonts and CSS -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-calculator.min.css">
    <link rel="stylesheet" href="css/emission_appli.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="js/vendor/modernizr-2.8.3-respond-1.4.2.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
    <!-- Header Section with Navigation Bar -->
    <div class="header">
        <div class="container">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="navbar-header">
                    <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse"
                        data-target="#main-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a href="index.html" class="navbar-brand scroll-top">
                        <img src="img/logo.png" alt="EcoInsight Logo" style="height: 80px; margin-right: 10px;">
                    </a>
                </div>
                <div id="main-nav" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html" class="scroll-top">Home</a></li>
                        <li><a href="index.html#contact-us" class="scroll-link" data-id="contact-us">our mission</a>
                        </li>
                        <li><a href="index.html#about" class="scroll-link" data-id="about">Services</a></li>
                        <li><a href="emission_cal_personal.html" id="clear-session-link">Emission Calculator</a></li>
                        <li><a href="recommendations.html">Recommendations</a></li>
                        <li><a href="education_hub.html">Education Hub</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <!-- Loading Animation with Tree GIF -->
    <div id="loading-animation" style="display: none;">
        <img src="img/tree.gif" alt="Loading..." style="width: 100px; height: auto;">
        <p>Calculating, please wait...</p>
    </div>

    <!-- CO2 Emission Calculator Section -->
    <div class="parallax-content" id="emission-calculator">
        <div class="container">
            <div class="col-md-3">
                <h2>Carbon Footprint Calculator</h2>
                <div class="progress">
                    <div class="progress-bar" role="progressbar" style="width: 80%;" aria-valuemin="0"
                        aria-valuemax="100"></div>
                </div>
            </div>
            <div class="col-md-9">
                <form id="emission-form">
                    <!-- Section 1: Appliance Selection -->
                    <div class="form-group">
                        <div class="icon-label-container">
                            <div class="appliance-icon-1"></div>
                            <label for="appliance-selection">What appliance(s) do you have in your household?</label>
                        </div>
                        <div id="appliance-selection" class="button-group">
                            <button type="button" class="btn" data-value="television">Television</button>
                            <button type="button" class="btn" data-value="dishwasher">Dishwasher</button>
                            <button type="button" class="btn" data-value="clothes_washer">Clothes Washer</button>
                            <button type="button" class="btn" data-value="clothes_dryer">Clothes Dryer</button>
                            <button type="button" class="btn" data-value="air_conditioner">Air Conditioner</button>
                            <button type="button" class="btn" data-value="refrigerator">Refrigerator</button>
                            <button type="button" class="btn" data-value="none" id="none-checkbox">None of the above
                            </button>
                        </div>

                        <!-- Section 2: Usage Hours (hidden initially) -->
                        <div id="appliance-usage-section" style="display: none;">
                            <div id="usage-questions"></div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Floating Navigation Buttons -->
    <div class="floating-buttons">
        <a href="emission_cal_trans.html" class="scroll-link" id="back-button">
            <i class="fa fa-arrow-left"></i> Back</a>

        <a href="#" class="scroll-link" id="next-button">
            Next <i class="fa fa-arrow-right"></i></a>
    </div>

    <!-- JavaScript -->
    <script src="js/vendor/jquery-1.11.1.min.js"></script>
    <script src="js/vendor/bootstrap.min.js"></script>
    <script src="js/vendor/owl.carousel.min.js"></script>
    <script src="js/vendor/lightbox.min.js"></script>
    <script src="js/main.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        // Show the loading animation
        function showLoading() {
            document.getElementById('loading-animation').style.display = 'flex';
        }

        // Hide the loading animation
        function hideLoading() {
            document.getElementById('loading-animation').style.display = 'none';
        }


        document.getElementById('clear-session-link').addEventListener('click', function () {
                sessionStorage.clear();
                console.log('SessionStorage cleared for Emission Calculator link.');
            });
        // Use sessionStorage to manage the flow properly
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('next-button').style.display = 'none';

            document.getElementById('next-button').addEventListener('click', function (event) {
                event.preventDefault();
                saveDataToSessionStorage();
                validateAndNavigate(); // Validate and navigate to the next page
            });

            document.getElementById('back-button').addEventListener('click', function (event) {
                event.preventDefault();
                if (confirm('Are you sure you want to start over? This will clear all current data.')) {
                    clearSessionStorage();
                }
                clearSessionStorage();
                window.history.back();
            });
        });

        function saveDataToSessionStorage() {
            // Retrieve selected appliances
            const selectedAppliances = Array.from(document.querySelectorAll('#appliance-selection .btn.selected-green'))
                .map(button => button.getAttribute('data-value'));

            // Save selected appliances
            sessionStorage.setItem('applianceData', JSON.stringify(selectedAppliances));

            // Iterate over each selected appliance and save relevant input data
            selectedAppliances.forEach(appliance => {
                // Save usage data if available
                const usageElement = document.getElementById(`${appliance}-hours`);
                if (usageElement) {
                    sessionStorage.setItem(`${appliance}-hours`, usageElement.value);
                }

                // Save brand data if available
                const brandElement = document.getElementById(`${appliance}-brand`);
                if (brandElement) {
                    sessionStorage.setItem(`${appliance}-brand`, brandElement.value);
                }

                // Save specific inputs for each appliance type
                switch (appliance) {
                    case 'television':
                        // Save screen size and technology type for televisions
                        const screenSize = document.getElementById('tv-screen-size').value;
                        const screenTech = document.querySelector('input[name="television-screen-tech"]:checked')?.value;
                        sessionStorage.setItem('television-screen-size', screenSize);
                        sessionStorage.setItem('television-screen-tech', screenTech);
                        break;

                    case 'clothes_washer':
                        // Save loading type and load size for clothes washers
                        const loadingType = document.querySelector('input[name="clothes-washer-loading"]:checked')?.value;
                        const loadSize = document.getElementById('clothes-washer-load-size').value;
                        sessionStorage.setItem('clothes_washer-loading', loadingType);
                        sessionStorage.setItem('clothes_washer-load-size', loadSize);
                        break;

                    case 'clothes_dryer':
                        // Save dryer type for clothes dryers
                        const dryerType = document.querySelector('input[name="clothes-dryer-type"]:checked')?.value;
                        sessionStorage.setItem('clothes_dryer-type', dryerType);
                        break;

                    case 'air_conditioner':
                        // Save type and hours for air conditioners
                        const acType = document.querySelector('input[name="air-conditioner-type"]:checked')?.value;
                        const acHours = document.getElementById('air-conditioner-hours').value;
                        sessionStorage.setItem('air_conditioner-type', acType);
                        sessionStorage.setItem('air_conditioner-hours', acHours);
                        break;

                    case 'refrigerator':
                        // Save volume category for refrigerators
                        const refrigeratorVolume = document.getElementById('refrigerator-volume').value;
                        sessionStorage.setItem('refrigerator-volume', refrigeratorVolume);
                        break;

                    case 'dishwasher':
                        // Save usage frequency for dishwashers
                        const dishwasherUsage = document.getElementById('dishwasher-usage').value;
                        sessionStorage.setItem('dishwasher-usage', dishwasherUsage);
                        break;

                    default:
                        console.warn(`No specific input handling for ${appliance}`);
                }
            });

            // Log the saved data for verification
            console.log('All user input data saved to sessionStorage:', sessionStorage);
        }

        function clearSessionStorage() {
            sessionStorage.removeItem('applianceData');

            // Remove each appliance's associated data
            const selectedAppliances = JSON.parse(sessionStorage.getItem('applianceData')) || [];
            selectedAppliances.forEach(appliance => {
                sessionStorage.removeItem(`${appliance}-hours`);
                sessionStorage.removeItem(`${appliance}-brand`);
            });

            console.log('SessionStorage cleared.');
        }

        // Clear all selections and ensure session storage management is correct
        function clearAllSelections() {
            document.querySelectorAll('#appliance-selection .appliance-btn').forEach(button => button.classList.remove('selected'));
            document.getElementById('usage-questions').innerHTML = '';
            document.getElementById('appliance-usage-section').style.display = 'none';
            // Optionally clear data specifically related to the selection
            sessionStorage.removeItem('applianceData');
        }

        // Manage clearing based on page context or user actions
        function handleNavigationClearance() {
            // Check context: only clear if restarting or leaving the entire process
            if (window.location.href.includes('start') || userConfirmedRestart) {
                clearSessionStorage();
            }
        }

        let isRefrigeratorSelected = false;
        let isRefrigeratorBrandSelected = false;

        function selectAppliance() {
            const selectedAppliances = Array.from(document.querySelectorAll('#appliance-selection .btn.selected-green')).map(button => button.getAttribute('data-value'));

            if (selectedAppliances.length === 0) {
                document.getElementById('usage-questions').innerHTML = '';
                document.getElementById('appliance-usage-section').style.display = 'none';
                document.getElementById('next-button').style.display = 'block'; // Ensure 'Next' button is shown
                return;
            }

            // Save selected appliances to sessionStorage
            sessionStorage.setItem('applianceData', JSON.stringify(selectedAppliances));
            console.log('Appliance data saved to sessionStorage:', selectedAppliances);

            updateQuestions(selectedAppliances);
            updateUsageSectionVisibility();
        }

        function updateQuestions(selectedAppliances) {
            const usageSection = document.getElementById('appliance-usage-section');
            const usageQuestions = document.getElementById('usage-questions');

            // Clear previous questions
            usageQuestions.innerHTML = '';

            // Define the HTML for each appliance's questions with headers and corresponding images
            const applianceQuestions = {
                'television': `
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/television.png" alt="Television Icon">
                    </span>
                    <span class="text">Television</span>
                </h3>
                    <div class="form-group">
                        <label for="tv-screen-size">What screen size is your television?</label>
                        <select id="tv-screen-size" class="form-control" style="width: 500px;">
                            <option value="">--Select Size--</option>
                            <option value="Less than 40">Less than 40"</option>
                            <option value="40-49">40 - 49"</option>
                            <option value="50-59">50 - 59"</option>
                            <option value="60-69">60 - 69"</option>
                            <option value="70-79">70 - 79"</option>
                            <option value="80-89">80 - 89"</option>
                            <option value="90-99">90 - 99"</option>
                            <option value="Greater than 100">Greater than 100"</option>
                        </select>
                    </div>
                    <div class="form-group radio-question">
                        <label for="television-screen-tech">What screen technology does your television use?</label>
                        <div class="radio-option">
                            <input type="radio" id="tech-lcd" name="television-screen-tech" value="LCD" required>
                            <label for="tech-lcd" class="radio-label">LCD</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="tech-plasma" name="television-screen-tech" value="Plasma" required>
                            <label for="tech-plasma" class="radio-label">Plasma</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="tech-led" name="television-screen-tech" value="LED" required>
                            <label for="tech-led" class="radio-label">LED</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="tech-oled" name="television-screen-tech" value="OLED" required>
                            <label for="tech-oled" class="radio-label">OLED</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="television-hours">How many hours do you watch television a week?</label>
                        <input type="number" class="form-control" id="television-hours" name="television-hours" min="1" value="1" required>
                    </div>
                `,
                'dishwasher': `
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/dishwasher.png" alt="Dishwasher Icon">
                    </span>
                    <span class="text">Dishwasher</span>
                </h3>
                    <div class="form-group">
                        <label for="dishwasher-usage">How many times do you use the dishwasher a week?</label>
                        <input type="number" class="form-control" id="dishwasher-usage" name="dishwasher-usage" min="1" value="1" required>
                    </div>
                `,
                'clothes_washer': `
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/clotheswasher.png" alt="Clotheswasher Icon">
                    </span>
                    <span class="text">Clothes Washer</span>
                </h3>
                    <div class="form-group radio-question">
                        <label for="clothes-washer-loading">What type of loading is your clothes washer?</label>
                        <div class="radio-option">
                            <input type="radio" id="washer-loading-front" name="clothes-washer-loading" value="Front" required>
                            <label for="washer-loading-front" class="radio-label">Front</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="washer-loading-top" name="clothes-washer-loading" value="Top" required>
                            <label for="washer-loading-top" class="radio-label">Top</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clothes-washer-load-size">What load size is your clothes washer?</label>
                    </div>
                    <div class="slider-container">
                        <input type="range" class="slider" id="clothes-washer-load-size" name="clothes-washer-load-size" min="2" max="19" step="0.5" value="10.5" required>
                        <div id="slider-value-container">
                            <span id="load-size-value">10.5 kg</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clothes-washer-usage">How many times do you use the clothes washer a week?</label>
                        <input type="number" class="form-control" id="clothes-washer-usage" name="clothes-washer-usage" min="1" value="1" required>
                    </div>
                `,
                'clothes_dryer': `
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/clothesdryer.png" alt="Clothesdryer Icon">
                    </span>
                    <span class="text">Clothes Dryer</span>
                </h3>
                    <div class="form-group radio-question">
                        <label for="clothes-dryer-type">What type of clothes dryer do you use?</label>
                        <div class="radio-option">
                            <input type="radio" id="dryer-type-vented" name="clothes-dryer-type" value="Vented" required>
                            <label for="dryer-type-vented" class="radio-label">Vented</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="dryer-type-condenser" name="clothes-dryer-type" value="Condenser" required>
                            <label for="dryer-type-condenser" class="radio-label">Condenser</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clothes-dryer-usage">How many times do you use the clothes dryer a week?</label>
                        <input type="number" class="form-control" id="clothes-dryer-usage" name="clothes-dryer-usage" min="1" value="1" required>
                    </div>
                `,
                'air_conditioner': `
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/air_conditioner.png">
                    </span>
                    <span class="text">Air Conditioner</span>
                </h3>
                    <div class="form-group radio-question">
                        <label for="air-conditioner-type">Is your air conditioner ducted or non-ducted?</label>
                        <div class="radio-option">
                            <input type="radio" id="ac-type-ducted" name="air-conditioner-type" value="Ducted" required>
                            <label for="ac-type-ducted" class="radio-label">Ducted</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="ac-type-non-ducted" name="air-conditioner-type" value="Non Ducted" required>
                            <label for="ac-type-non-ducted" class="radio-label">Non Ducted</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="ac-type-both" name="air-conditioner-type" value="Both" required>
                            <label for="ac-type-both" class="radio-label">Both</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="air-conditioner-hours">How many hours do you use the air conditioner in a week?</label>
                        <input type="number" class="form-control" id="air-conditioner-hours" name="air-conditioner-hours" min="1" value="1" required>
                    </div>
                `,
                'refrigerator': `
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/refrigerator.png" alt="Refrigerator Icon">
                    </span>
                    <span class="text">Refrigerator</span>
                </h3>
                    <div class="form-group">
                        <label for="refrigerator-volume">What volume is your refrigerator?</label>
                        <select class="form-control" id="refrigerator-volume" name="refrigerator-volume" style="width: 500px;" required>
                            <option value="">--Select Volume--</option>
                            <option value="<99L">Less than 99L</option>
                            <option value="100-199L">100 - 199L</option>
                            <option value="200-299L">200 - 299L</option>
                            <option value="300-399L">300 - 399L</option>
                            <option value="400-499L">400 - 499L</option>
                            <option value="500-599L">500 - 599L</option>
                            <option value="600-699L">600 - 699L</option>
                            <option value=">700L">More than 700L</option>
                        </select>
                    </div>
                `
            };

            // Generate the HTML based on the selected appliances
            selectedAppliances.forEach(appliance => {
                if (applianceQuestions[appliance]) {
                    const questionHTML = applianceQuestions[appliance];
                    usageQuestions.innerHTML += questionHTML;
                } else {
                    console.warn('Unknown or unsupported appliance type:', appliance);
                }
            });

            // Show the usage section if questions are added
            if (usageQuestions.innerHTML.trim()) {
                usageSection.style.display = 'block';
                document.getElementById('next-button').style.display = 'block';
            } else {
                usageSection.style.display = 'none';
                document.getElementById('next-button').style.display = 'none';
            }
        }

        function showQuestions() {
            const selectedAppliances = Array.from(document.querySelectorAll('#appliance-selection .btn.selected-green'))
                .map(button => button.getAttribute('data-value'));

            // Debugging output
            console.log('Selected Appliances:', selectedAppliances);

            // Call the function to update questions
            updateQuestions(selectedAppliances);
        }

        function updateUsageSectionVisibility() {
            const usageSection = document.getElementById('appliance-usage-section');
            const usageQuestions = document.getElementById('usage-questions');

            if (usageQuestions.innerHTML.trim()) {
                usageSection.style.display = 'block';
                document.getElementById('next-button').style.display = 'block';
            } else {
                usageSection.style.display = 'none';
                document.getElementById('next-button').style.display = 'none';
            }
        }

        document.getElementById('appliance-selection').addEventListener('click', function (event) {
            if (event.target.classList.contains('btn')) {
                const noneButton = document.getElementById('none-checkbox');
                const applianceButtons = document.querySelectorAll('#appliance-selection .btn');

                if (event.target.id === 'none-checkbox') {
                    noneButton.classList.add('selected-green');
                    applianceButtons.forEach(button => {
                        if (button.id !== 'none-checkbox') {
                            button.classList.remove('selected-green');
                        }
                    });
                    document.getElementById('usage-questions').innerHTML = '';
                    document.getElementById('appliance-usage-section').style.display = 'none';
                    document.getElementById('next-button').style.display = 'block';
                } else {
                    event.target.classList.toggle('selected-green');
                    noneButton.classList.remove('selected-green');
                    selectAppliance();
                }
            }
        });

        async function sendDataToLambda(data) {
    showLoading();
    try {
        console.log('Original data:', data);

        // Format the data for each appliance type
        const formattedData = data.appliances.map(item => {
            let formattedItem = {
                type: 'appliance',
                appliance_type: item.appliance_type
            };

            switch (item.appliance_type) {
                case 'clothes_washer':
                    formattedItem.Loading = item.Loading;
                    formattedItem.Cap = item.Cap;
                    formattedItem.usage_per_week = item.usage_per_week;
                    break;
                case 'refrigerator':
                    formattedItem.volume_category = item.volume_category.trim();
                    break;
                case 'television':
                    formattedItem.screen_size_category = item.screen_size_category.replace('-', ' - ');
                    formattedItem.screen_technology = item.screen_technology || '';
                    formattedItem.hours = item.hours;
                    break;
                case 'air_conditioner':
                    formattedItem.Configuration1 = item.Configuration1;
                    formattedItem.hours_per_day = item.hours_per_day;
                    break;
                case 'dishwasher':
                    formattedItem.usage_per_week = item.usage_per_week;
                    break;
                default:
                    formattedItem.hours = item.hours; // For other appliances
                    break;
            }

            return formattedItem;
        });

        console.log('Formatted data to send:', formattedData);

        // Send data for each appliance and handle their responses
        const responses = await Promise.all(formattedData.map(async item => {
            const response = await fetch('https://t5tau9uvbf.execute-api.ap-southeast-2.amazonaws.com/Eco/calculator', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(item),
            });

            if (!response.ok) {
                const errorDetails = await response.text();
                console.error(`Network response was not ok. Status: ${response.status}. Details: ${errorDetails}`);
                throw new Error(`Network response was not ok. Status: ${response.status}. Details: ${errorDetails}`);
            }

            return response.json();
        }));

        console.log('Data sent successfully:', responses);

        // Object to store all individual appliance emissions correctly
        const allIndividualApplianceEmissions = {};

        // Store individual emissions for each appliance type correctly
        responses.forEach(response => {
            if (response && response.individual_appliance_emissions) {
                Object.entries(response.individual_appliance_emissions).forEach(([applianceType, emission]) => {
                    // Ensure the key corresponds correctly to the appliance
                    const emissionsKey = `emissions_${applianceType}`;
                    allIndividualApplianceEmissions[applianceType] = emission;
                    sessionStorage.setItem(emissionsKey, JSON.stringify({ appliance_emissions: emission }));
                });
            }
        });

        // Check and handle missing appliances
        const selectedAppliances = JSON.parse(sessionStorage.getItem('applianceData')) || [];
        selectedAppliances.forEach(appliance => {
            if (!allIndividualApplianceEmissions[appliance]) {
                allIndividualApplianceEmissions[appliance] = 0; // Default to zero if no data available
                sessionStorage.setItem(`emissions_${appliance}`, JSON.stringify({ appliance_emissions: 0 }));
            }
        });

        // Store all individual appliance emissions in a single object for overall reference
        sessionStorage.setItem('individualApplianceEmissions', JSON.stringify(allIndividualApplianceEmissions));
        console.log('Combined individual appliance emissions saved:', allIndividualApplianceEmissions);

        // Calculate total emissions correctly
        const totalEmissions = Object.values(allIndividualApplianceEmissions).reduce((total, emission) => total + emission, 0);
        sessionStorage.setItem('totalEmissions', totalEmissions.toFixed(2));
        console.log('Total emissions calculated:', totalEmissions);

        window.location.href = 'emission_result.html'; // Navigate to the results page
    } catch (error) {
        console.error('Error sending data:', error);
        alert('There was an error submitting your data. Please try again.');
    } finally {
        hideLoading();
    }
}





        function validateAndNavigate() {
            let isValid = true;
            const applianceData = [];

            // Get all appliance sections
            const applianceSections = document.querySelectorAll('#usage-questions .form-group');

            applianceSections.forEach(section => {
                // Check for dropdowns
                const dropdown = section.querySelector('select');
                if (dropdown) {
                    const selectedValue = dropdown.value;
                    if (!selectedValue) {
                        alert(`Please select a value for ${dropdown.previousElementSibling.textContent}`);
                        isValid = false;
                        dropdown.style.borderColor = 'red';
                    } else {
                        dropdown.style.borderColor = ''; // Reset border color if valid

                        // Handle television inputs
                        if (dropdown.id === 'tv-screen-size') {
                            const screenTech = document.querySelector('input[name="television-screen-tech"]:checked');
                            const hours = parseInt(document.getElementById('television-hours').value, 10) || 0;

                            // Check for all necessary inputs for television
                            if (!screenTech || hours <= 0) {
                                alert('Please complete all fields for the television.');
                                isValid = false;
                            } else {
                                // Push the correct data format for the television
                                applianceData.push({
                                    appliance_type: 'television',
                                    screen_size_category: selectedValue,  // Ensure correct format like "40 - 49"
                                    screen_technology: screenTech.value,
                                    hours: hours
                                });
                            }
                        }

                        // Handle refrigerator inputs
                        else if (dropdown.id === 'refrigerator-volume') {
                            // For refrigerators, no hours are needed, just capture the volume
                            applianceData.push({
                                appliance_type: 'refrigerator',
                                volume_category: selectedValue
                            });
                        }
                    }
                }

                // Check for radio buttons
                const radioButtons = section.querySelectorAll('input[type="radio"]');
                if (radioButtons.length > 0) {
                    const selectedRadio = Array.from(radioButtons).find(radio => radio.checked);
                    if (!selectedRadio) {
                        alert(`Please select an option for ${section.querySelector('label').textContent}`);
                        isValid = false;
                        section.querySelector('label').style.color = 'red'; // Optional: highlight the label
                    } else {
                        section.querySelector('label').style.color = ''; // Reset label color if valid

                        // Handle clothes washer inputs
                        // Validate Clothes Washer inputs
                        if (section.querySelector('input[name="clothes-washer-loading"]')) {
                            const loadSize = parseFloat(document.getElementById('clothes-washer-load-size').value);
                            const usagePerWeek = parseInt(document.getElementById('clothes-washer-usage').value, 10);
                            if (isNaN(loadSize) || loadSize <= 0 || isNaN(usagePerWeek) || usagePerWeek <= 0) {
                                alert('Please complete all fields for the clothes washer.');
                                isValid = false;
                            } else {
                                applianceData.push({
                                    appliance_type: 'clothes_washer',
                                    Loading: selectedRadio.value,
                                    Cap: loadSize,  // Correctly fetch the value from slider
                                    usage_per_week: usagePerWeek
                                });
                            }
                        }

                        // Handle clothes dryer inputs
                        else if (section.querySelector('input[name="clothes-dryer-type"]')) {
                            const usagePerWeek = parseInt(document.getElementById('clothes-dryer-usage').value, 10);
                            if (isNaN(usagePerWeek) || usagePerWeek <= 0) {
                                alert('Please complete all fields for the clothes dryer.');
                                isValid = false;
                            } else {
                                applianceData.push({
                                    appliance_type: 'clothes_dryer',
                                    Type: selectedRadio.value,
                                    usage_per_week: usagePerWeek
                                });
                            }
                        }

                        // Handle air conditioner inputs
                        else if (section.querySelector('input[name="air-conditioner-type"]')) {
                            const hoursPerDay = parseFloat(document.getElementById('air-conditioner-hours').value);
                            if (isNaN(hoursPerDay) || hoursPerDay <= 0) {
                                alert('Please complete all fields for the air conditioner.');
                                isValid = false;
                            } else {
                                applianceData.push({
                                    appliance_type: 'air_conditioner',
                                    Configuration1: selectedRadio.value,
                                    hours_per_day: hoursPerDay
                                });
                            }
                        }
                    }
                }

                // Check for numeric inputs not covered above
                const numberInput = section.querySelector('input[type="number"]');
                if (numberInput && numberInput.name.includes('hours') && numberInput.value <= 0) {
                    alert(`Please enter a valid number greater than 0 for ${numberInput.previousElementSibling.textContent}`);
                    isValid = false;
                    numberInput.style.borderColor = 'red';
                } else if (numberInput) {
                    numberInput.style.borderColor = ''; // Reset border color if valid
                }
            });

            // Proceed to the next page if all validations pass
            if (isValid) {
                // Remove duplicates and incomplete data
                const uniqueApplianceData = applianceData.filter((item, index, self) =>
                    index === self.findIndex((t) => (
                        t.appliance_type === item.appliance_type &&
                        (t.screen_size_category || '') === (item.screen_size_category || '') &&
                        (t.screen_technology || '') === (item.screen_technology || '')
                    ))
                );

                console.log('Validated and unique data to send:', uniqueApplianceData);

                const data = { appliances: uniqueApplianceData };
                sendDataToLambda(data);
            }
        }
    </script>
</body>

</html>