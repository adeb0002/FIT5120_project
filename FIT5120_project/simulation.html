<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Eco Simulation</title>
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/emission_appli.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
            background-color: #f4f4f4;
        }

        .simulation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 auto;
            max-width: 1200px;
            padding: 0px;
        }

        .header-section {
            text-align: center;
            width: 100%;
            padding: 100px 0 0 0;
        }

        .form-charts-container {
            display: flex;
            width: 100%;
            justify-content: space-between;
            margin-top: 0;
        }

        .form-section, .charts-section {
            flex: 1;
            padding: 20px;
        }

        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .chart {
            flex-basis: 100%;
            padding: 20px;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        @media (max-width: 800px) {
            .form-charts-container {
                flex-direction: column;
            }
        }

        .slider {
            width: 100%;
            margin: 15px 0;
        }

        h4 {
            margin-top: 20px;
        }

        button {
            margin: 20px 10px;
            padding: 15px 30px;
            font-weight: bold;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 8px;
        }

        button:hover {
            background-color: #45a049;
        }

        .reset-btn {
            background-color: #f44336;
        }

        .reset-btn:hover {
            background-color: #e53935;
        }

        footer {
            margin-top: 40px;
            padding: 20px;
            text-align: center;
            background-color: #f1f1f1;
        }

        .highlight {
            color: green;
            font-weight: bold;
        }

        .btn-radio {
            background-color: #f4f4f4;
            border: 2px solid #ccc;
            border-radius: 5px;
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        input[type="radio"] {
            display: none;
        }

        input[type="radio"]:checked + .btn-radio {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .radio-question {
            margin-bottom: 20px;
        }

        .radio-option-group {
            display: inline-flex; /* This ensures buttons stay in a row */
            flex-wrap: wrap;      /* Allows wrapping if there's not enough space */
        }

        .radio-option {
            margin-right: 15px;   /* Space between buttons */
            margin-bottom: 10px;  /* Ensure some space between buttons if they wrap */
        }

        .button-section {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .total-emissions {
            font-size: 20px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <!-- Header Section with Navigation Bar -->
    <div class="header">
        <div class="container">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="navbar-header">
                    <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span the class="icon-bar"></span>
                        <span the class="icon-bar"></span>
                    </button>
                    <a href="index.html" class="navbar-brand scroll-top">
                        <img src="img/logo.png" alt="EcoInsight Logo" style="height: 80px; margin-right: 10px;">
                    </a>
                </div>
                <div id="main-nav" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html" class="scroll-top">Home</a></li>
                        <li><a href="index.html#contact-us" class="scroll-link" data-id="contact-us">Our Mission</a></li>
                        <li><a href="index.html#about" class="scroll-link" data-id="about">Services</a></li>
                        <li><a href="#" id="clear-session-link">Emission Calculator</a></li>
                        <li><a href="recommendations.html">Recommendations</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <div class="simulation-container">
        <div class="header-section">
            <h1>Eco Simulation</h1>
            <p>Adjust your lifestyle choices to see real-time changes in carbon emissions and cost savings.</p>
            
            <!-- Prominent Apply and Reset buttons at the top -->
            <div class="button-section">
                <button onclick="applyChanges()">Apply</button>
                <button class="reset-btn" onclick="resetChanges()">Reset</button>
            </div>

            <!-- Total CO2 Emissions Display -->
            <div class="total-emissions">
                <span id="total-emissions">Total CO2 Emissions: 0 kg</span>
            </div>
        </div>

        <div class="form-charts-container">
            <div class="form-section">

                <!-- Energy Section -->
                <h4>Energy:</h4>

                <div class="form-group">
                    <label>Solar Panels:</label>
                    <div class="radio-option">
                        <input type="radio" id="solar-yes" name="solar-panels" value="yes">
                        <label for="solar-yes" class="btn-radio">Yes</label>
                        <input type="radio" id="solar-no" name="solar-panels" value="no">
                        <label for="solar-no" class="btn-radio">No</label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Gas Water Heater:</label>
                    <div class="radio-option">
                        <input type="radio" id="gas-yes" name="gas-water-heater" value="yes">
                        <label for="gas-yes" class="btn-radio">Yes</label>
                        <input type="radio" id="gas-no" name="gas-water-heater" value="no">
                        <label for="gas-no" class="btn-radio">No</label>
                    </div>
                </div>

                <!-- Transport Section with four different transport types -->
                <h4>Transport:</h4>
                <label for="car-distance">Car Commute (km/week):</label>
                <input type="range" id="car-distance" class="slider" min="0" max="100" value="20" step="1">
                <span id="car-value">20km</span>

                <label for="train-distance">Train Commute (km/week):</label>
                <input type="range" id="train-distance" class="slider" min="0" max="100" value="20" step="1">
                <span id="train-value">20km</span>

                <label for="bus-distance">Bus Commute (km/week):</label>
                <input type="range" id="bus-distance" class="slider" min="0" max="100" value="20" step="1">
                <span id="bus-value">20km</span>

                <label for="tram-distance">Tram Commute (km/week):</label>
                <input type="range" id="tram-distance" class="slider" min="0" max="100" value="20" step="1">
                <span id="tram-value">20km</span>

                <h4>Appliance Use:</h4>

                <!-- Television Section -->
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/television.png" alt="Television Icon">
                    </span>
                    <span class="text">Television</span>
                </h3>
                <div class="form-group">
                    <label for="tv-screen-size">What screen size is your television?</label>
                    <select id="tv-screen-size" class="form-control" style="width: 500px;">
                        <option value="">--Select Size--</option>
                        <option value="Less than 40">Less than 40"</option>
                        <option value="40-49">40 - 49"</option>
                        <option value="50-59">50 - 59"</option>
                        <option value="60-69">60 - 69"</option>
                        <option value="70-79">70 - 79"</option>
                        <option value="80-89">80 - 89"</option>
                        <option value="90-99">90 - 99"</option>
                        <option value="Greater than 100">Greater than 100"</option>
                    </select>
                </div>
                <div class="form-group radio-question">
                    <label for="television-screen-tech">What screen technology does your television use?</label>
                    <div class="radio-option-group">
                        <div class="radio-option">
                            <input type="radio" id="tech-lcd" name="television-screen-tech" value="LCD" required>
                            <label for="tech-lcd" class="radio-label btn-radio">LCD</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="tech-plasma" name="television-screen-tech" value="Plasma" required>
                            <label for="tech-plasma" class="radio-label btn-radio">Plasma</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="tech-led" name="television-screen-tech" value="LED" required>
                            <label for="tech-led" class="radio-label btn-radio">LED</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="tech-oled" name="television-screen-tech" value="OLED" required>
                            <label for="tech-oled" class="radio-label btn-radio">OLED</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="television-hours">How many hours do you watch television a week?</label>
                    <input type="number" class="form-control" id="television-hours" name="television-hours" min="1" value="1" required>
                </div>

                <!-- Dishwasher Section -->
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/dishwasher.png" alt="Dishwasher Icon">
                    </span>
                    <span class="text">Dishwasher</span>
                </h3>
                <div class="form-group">
                    <label for="dishwasher-usage">How many times do you use the dishwasher a week?</label>
                    <input type="number" class="form-control" id="dishwasher-usage" name="dishwasher-usage" min="1" value="1" required>
                </div>

                <!-- Clothes Washer Section -->
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/clotheswasher.png" alt="Clotheswasher Icon">
                    </span>
                    <span class="text">Clothes Washer</span>
                </h3>
                <div class="form-group radio-question">
                    <label for="clothes-washer-loading">What type of loading is your clothes washer?</label>
                    <div class="radio-option-group">
                        <div class="radio-option">
                            <input type="radio" id="washer-loading-front" name="clothes-washer-loading" value="Front" required>
                            <label for="washer-loading-front" class="radio-label btn-radio">Front</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="washer-loading-top" name="clothes-washer-loading" value="Top" required>
                            <label for="washer-loading-top" class="radio-label btn-radio">Top</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="clothes-washer-load-size">What load size is your clothes washer?</label>
                </div>
                <div class="slider-container">
                    <input type="range" class="slider" id="clothes-washer-load-size" name="clothes-washer-load-size" min="2" max="19" step="0.5" value="10.5" required>
                    <div id="slider-value-container">
                        <span id="load-size-value">10.5 kg</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="clothes-washer-usage">How many times do you use the clothes washer a week?</label>
                    <input type="number" class="form-control" id="clothes-washer-usage" name="clothes-washer-usage" min="1" value="1" required>
                </div>

                <!-- Clothes Dryer Section -->
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/clothesdryer.png" alt="Clothesdryer Icon">
                    </span>
                    <span class="text">Clothes Dryer</span>
                </h3>

                <div class="form-group radio-question">
                    <label for="clothes-dryer-type">What type of clothes dryer do you use?</label>
                    <div class="radio-option-group">
                        <div class="radio-option">
                            <input type="radio" id="dryer-type-vented" name="clothes-dryer-type" value="Vented" required>
                            <label for="dryer-type-vented" class="radio-label btn-radio">Vented</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="dryer-type-condenser" name="clothes-dryer-type" value="Condenser" required>
                            <label for="dryer-type-condenser" class="radio-label btn-radio">Condenser</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="clothes-dryer-usage">How many times do you use the clothes dryer a week?</label>
                    <input type="number" class="form-control" id="clothes-dryer-usage" name="clothes-dryer-usage" min="1" value="1" required>
                </div>

                <!-- Air Conditioner Section -->
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/air_conditioner.png">
                    </span>
                    <span class="text">Air Conditioner</span>
                </h3>
                <div class="form-group radio-question">
                    <label for="air-conditioner-type">Is your air conditioner ducted or non-ducted?</label>
                    <div class="radio-option-group">
                        <div class="radio-option">
                            <input type="radio" id="ac-type-ducted" name="air-conditioner-type" value="Ducted" required>
                            <label for="ac-type-ducted" class="radio-label btn-radio">Ducted</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="ac-type-non-ducted" name="air-conditioner-type" value="Non Ducted" required>
                            <label for="ac-type-non-ducted" class="radio-label btn-radio">Non Ducted</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="ac-type-both" name="air-conditioner-type" value="Both" required>
                            <label for="ac-type-both" class="radio-label btn-radio">Both</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="air-conditioner-hours">How many hours do you use the air conditioner in a week?</label>
                    <input type="number" class="form-control" id="air-conditioner-hours" name="air-conditioner-hours" min="1" value="1" required>
                </div>

                <!-- Refrigerator Section -->
                <h3 class="icon-text">
                    <span class="icon">
                        <img src="img/refrigerator.png" alt="Refrigerator Icon">
                    </span>
                    <span class="text">Refrigerator</span>
                </h3>
                <div class="form-group">
                    <label for="refrigerator-volume">What volume is your refrigerator?</label>
                    <select class="form-control" id="refrigerator-volume" name="refrigerator-volume" style="width: 500px;" required>
                        <option value="">--Select Volume--</option>
                        <option value="<99L">Less than 99L</option>
                        <option value="100-199L">100 - 199L</option>
                        <option value="200-299L">200 - 299L</option>
                        <option value="300-399L">300 - 399L</option>
                        <option value="400-499L">400 - 499L</option>
                        <option value="500-599L">500 - 599L</option>
                        <option value="600-699L">600 - 699L</option>
                        <option value=">700L">More than 700L</option>
                    </select>
                </div>

                <!-- Apply and Reset buttons at the bottom -->
                <div class="button-section">
                    <button onclick="applyChanges()">Apply</button>
                    <button class="reset-btn" onclick="resetChanges()">Reset</button>
                </div>
            </div>

            <div class="charts-section">
                <div class="chart-container">
                    <div class="chart">
                        <h4>Emissions (Current vs Simulated)</h4>
                        <canvas id="emissionsChart"></canvas>
                    </div>
                    <div class="chart">
                        <h4>Cost (Current vs Simulated)</h4>
                        <canvas id="costChart"></canvas>
                    </div>
                </div>                
            </div>
        </div>
    </div>

    <footer>
        Ready to take action?
        <p>Use our <a href="#">Emissions Calculator</a> to discover your personal carbon footprint and ways to reduce it.</p>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Get references to input fields
        const solarPanels = document.getElementById('solar-panels');
        const gasWaterHeater = document.getElementById('gas-water-heater');
    
        const carDistance = document.getElementById('car-distance');
        const trainDistance = document.getElementById('train-distance');
        const busDistance = document.getElementById('bus-distance');
        const tramDistance = document.getElementById('tram-distance');
    
        const tvScreenSize = document.getElementById('tv-screen-size');
        const televisionHours = document.getElementById('television-hours');
        const dishwasherUsage = document.getElementById('dishwasher-usage');
        const washerUsage = document.getElementById('clothes-washer-usage');
        const dryerUsage = document.getElementById('clothes-dryer-usage');
        const acHours = document.getElementById('air-conditioner-hours');
        const refrigeratorVolume = document.getElementById('refrigerator-volume');
    
        // Function to retrieve current emissions from sessionStorage
        function getCurrentEmissions() {
            return {
                television: JSON.parse(sessionStorage.getItem('emissions_television'))?.appliance_emissions || 0,
                dishwasher: JSON.parse(sessionStorage.getItem('emissions_dishwasher'))?.appliance_emissions || 0,
                clothes_washer: JSON.parse(sessionStorage.getItem('emissions_clothes_washer'))?.appliance_emissions || 0,
                clothes_dryer: JSON.parse(sessionStorage.getItem('emissions_clothes_dryer'))?.appliance_emissions || 0,
                air_conditioner: JSON.parse(sessionStorage.getItem('emissions_air_conditioner'))?.appliance_emissions || 0,
                refrigerator: JSON.parse(sessionStorage.getItem('emissions_refrigerator'))?.appliance_emissions || 0,
                transport: sessionStorage.getItem('transportEmissions') || 0
            };
        }

        // Function to retrieve the value of the selected radio button
        function getSelectedRadioValue(name) {
            const radios = document.getElementsByName(name);
            for (let radio of radios) {
                if (radio.checked) {
                    return radio.value;
                }
            }
            return null; // Return null if no selection is made
        }
    
        // Function to send data to the backend and get simulated emissions
        function applyChanges() {
            const data = {
                solarPanels: getSelectedRadioValue('solar-panels'),
                gasWaterHeater: getSelectedRadioValue('gas-water-heater'),
                tvScreenSize: tvScreenSize.value,
                televisionHours: parseFloat(televisionHours.value),
                dishwasherUsage: parseFloat(dishwasherUsage.value),
                washerUsage: parseFloat(washerUsage.value),
                dryerUsage: parseFloat(dryerUsage.value),
                acHours: parseFloat(acHours.value),
                refrigeratorVolume: refrigeratorVolume.value,
                carDistance: parseFloat(carDistance.value),
                trainDistance: parseFloat(trainDistance.value),
                busDistance: parseFloat(busDistance.value),
                tramDistance: parseFloat(tramDistance.value)
            };
    
            // Send the data to the backend for simulated emissions calculation
            fetch('https://t5tau9uvbf.execute-api.ap-southeast-2.amazonaws.com/Eco/calculator', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            })
            .then(response => response.json())
            .then(result => {
                const totalEmissions = result.total_emissions || 0;
                document.getElementById('total-emissions').innerText = `Total CO2 Emissions: ${totalEmissions.toFixed(2)} kg`;
    
                // Update charts with the new values
                updateCharts(result.simulated_emissions);
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    
        // Function to update emissions and cost charts
        function updateCharts(simulatedEmissions) {
            const currentEmissions = getCurrentEmissions();
            const categories = ['Television', 'Dishwasher', 'Washer', 'Dryer', 'Air Conditioner', 'Transport'];
    
            const currentEmissionsArray = [
                currentEmissions.television, currentEmissions.dishwasher, currentEmissions.clothes_washer, 
                currentEmissions.clothes_dryer, currentEmissions.air_conditioner, currentEmissions.transport
            ];
    
            const simulatedEmissionsArray = [
                simulatedEmissions.television, simulatedEmissions.dishwasher, simulatedEmissions.clothes_washer, 
                simulatedEmissions.clothes_dryer, simulatedEmissions.air_conditioner, simulatedEmissions.transport
            ];
    
            // Update emissions chart
            new Chart(document.getElementById('emissionsChart'), {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [
                        { label: 'Current Emissions', data: currentEmissionsArray, backgroundColor: 'rgba(54, 162, 235, 0.5)' },
                        { label: 'Simulated Emissions', data: simulatedEmissionsArray, backgroundColor: 'rgba(255, 99, 132, 0.5)' }
                    ]
                },
                options: {
                    scales: { y: { beginAtZero: true } }
                }
            });
    
            // Update cost chart (example logic for cost calculation)
            const currentCosts = currentEmissionsArray.map(e => e * 0.1);  // Example conversion to cost
            const simulatedCosts = simulatedEmissionsArray.map(e => e * 0.1);  // Example conversion to cost
    
            new Chart(document.getElementById('costChart'), {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [
                        { label: 'Current Cost', data: currentCosts, backgroundColor: 'rgba(54, 162, 235, 0.5)' },
                        { label: 'Simulated Cost', data: simulatedCosts, backgroundColor: 'rgba(255, 99, 132, 0.5)' }
                    ]
                },
                options: {
                    scales: { y: { beginAtZero: true } }
                }
            });
        }
    
        // Reset function to clear session storage and reset charts
        function resetChanges() {
            sessionStorage.removeItem('simulationData');
            updateCharts({});  // Empty data for charts
            document.getElementById('total-emissions').innerText = 'Total CO2 Emissions: 0 kg';
        }
    
        // Load existing data from session storage on page load
        window.onload = function () {
            const storedData = JSON.parse(sessionStorage.getItem('simulationData'));
            if (storedData) {
                solarPanels.checked = storedData.solarPanels || false;
                gasWaterHeater.checked = storedData.gasWaterHeater || false;
    
                // Populate fields with stored data
                carDistance.value = storedData.carDistance || 20;
                trainDistance.value = storedData.trainDistance || 20;
                busDistance.value = storedData.busDistance || 20;
                tramDistance.value = storedData.tramDistance || 20;
    
                tvScreenSize.value = storedData.tvScreenSize || '';
                televisionHours.value = storedData.televisionHours || 1;
                dishwasherUsage.value = storedData.dishwasherUsage || 1;
                washerUsage.value = storedData.washerUsage || 1;
                dryerUsage.value = storedData.dryerUsage || 1;
                acHours.value = storedData.acHours || 1;
                refrigeratorVolume.value = storedData.refrigeratorVolume || '';
    
                // Load stored data into charts
                applyChanges();
            } else {
                resetChanges();
            }
        };
</script>
</body>
</html>
