<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Eco Simulation</title>
    <link rel="icon" href="img/icon.png" type="image/png"> 
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700,800" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/emission_appli.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Open Sans', sans-serif;
            overflow:auto;
            height: 100%;
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .simulation-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 auto;
            max-width: 1200px;
            min-height: 100vh;
            padding-bottom: 100px; /* Add extra padding for the footer */
            box-sizing: border-box;
        }

        /* Header styling */
        .header-section {
            text-align: center;
            padding: 130px 0 0 0;
            font-family: 'Open Sans', sans-serif;
        }

        /* Main Title Styling */
        .header-section h1 {
            font-size: 2.5em;
            font-weight: bold;
            color: #1f3b4d; /* Dark color for primary text */
            text-transform: uppercase;
            margin: 0;
        }


        /* Container for subtitle */
        .subtitle-container {
            display: flex;
            justify-content: center; /* Centers the subtitle container */
            align-items: center;
            margin: 20px 0;
        }

        /* Header title */
        .header-section p {
            font-size: 1.2em;
            color: #67b53f; /* Accent color for secondary text */
            margin: 10px 0;
        }

        /* Styling for the lines */
        .subtitle-text::before,
        .subtitle-text::after {
            content: '';
            display: inline-block;
            width: 220px; /* Length of the line on both sides */
            height: 2px;
            background-color: #4e8e31; /* Green color for the lines */
            margin: 0 15px; /* Space between the text and the lines */
        }

        /* Ensure that the text is in the middle */
        .subtitle-text {
            font-size: 1.5em;
            color: #4e8e31;
            white-space: nowrap; /* Prevent text wrapping */
            font-weight: bold;
        }

        /* Header description */
        .header-section p {
            font-size: 1.4em;
            margin-bottom: 30px;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }

        .form-charts-container {
            display: flex;
            flex-wrap: wrap; /* This allows the charts to wrap if the space is too small */
            justify-content: space-between;
            width: 100%;
        }

        .form-section, .charts-section {
            flex: 1;
            padding: 20px;
            min-width: 400px;
            max-width: 500px;
            flex-grow: 1;
        }

        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            width: 100%;
            height: 400px; 
            max-width: 1000px;
            margin-bottom: 20px; 
            position: relative;
        }

        .chart {
            position: relative;
            flex-basis: 100%;
            padding: 20px;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: 100%;
            margin-bottom: 50px;
        }

        @media (max-width: 800px) {
            .form-charts-container {
                flex-direction: column;
            }
        }

        .slider {
            width: 50%;
            margin: 15px 0;
        }

        h4 {
            margin-top: 20px;
        }

        button {
            margin: 20px 10px;
            padding: 15px 30px;
            font-weight: bold;
            font-size: 16px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 8px;
        }

        button:hover {
            background-color: #45a049;
        }

        .reset-btn {
            background-color: #f44336;
        }

        .reset-btn:hover {
            background-color: #e53935;
        }

        footer {
            padding: 20px;
            text-align: center;
            width: 100%;
            position: relative; /* Relative positioning so it's not fixed */
            bottom: 0; /* Keep the footer at the bottom of the container */
            clear: both;
        }

        .highlight {
            color: green;
            font-weight: bold;
        }

        .btn-radio {
            background-color: #f4f4f4;
            border: 2px solid #ccc;
            border-radius: 5px;
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap; /* Prevents text from wrapping */
            min-width: 100px; /* Optional: Set a minimum width to ensure enough space */
            text-align: center; /* Aligns the text in the center */
        }

        input[type="radio"] {
            display: none;
        }

        input[type="radio"]:checked + .btn-radio {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .radio-question {
            margin-bottom: 20px;
        }

        .radio-option-group {
            display: inline-flex; /* This ensures buttons stay in a row */
            flex-wrap: wrap;      /* Allows wrapping if there's not enough space */
        }

        .radio-option {
            margin-right: 15px;   /* Space between buttons */
            margin-bottom: 10px;  /* Ensure some space between buttons if they wrap */
        }

        .button-section {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .button-section button {
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            background-color: #4CAF50;
            border: none;
            border-radius: 50px;
            margin: 0 15px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .button-section button:hover {
            background-color: #45a049;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .total-emissions {
            font-size: 2em;
            font-weight: bold;
            color: #1f3b4d;
            padding: 20px;
            display: inline-block;
            margin-top: 20px;
        }

        .value-container {
            display: flex;
            justify-content: center; /* Centers the content horizontally */
            margin-top: 10px; /* Optional: Adds some space above the value */
        }

        #backToTopBtn {
            display: block; /* Temporarily force display for testing */
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999; /* Ensure the button is on top of other elements */
            width: 50px;
            height: 50px;
            background-color: red; /* Visible background color for testing */
            cursor: pointer;
        }

        #backToTopBtn:hover {
            opacity: 0.8; /* Slight opacity change on hover */
        }

        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }

        .radio-option label {
            display: block;
            margin-bottom: 5px;
        }

        .form-group .radio-option {
            flex: 2; 
            display: flex;
            justify-content: flex-start; 
        }

        .radio-option label {
            margin-right: 15px; 
        }
        .radio-option {
            flex: 1;
            display: flex;
            justify-content: center; /* Centers the button text */
        }

        .radio-question {
            margin-bottom: 20px;
            display: flex;
            flex-direction: column; /* Ensures label appears above the buttons */
        }

        .radio-option-group {
            display: flex;
            justify-content: space-between; /* Ensures even spacing between buttons */
            flex-wrap: nowrap; /* Prevents wrapping to the next line */
            gap: 15px; /* Adds spacing between buttons */
        }

        .icon-text {
            margin-top: 30px;
            display: flex;
            align-items: center;
            margin-left: -20px; /* Adjust this value as per your requirement */
        }

        .icon {
            margin-right: 10px; /* Space between the icon and the text */
        }

        .text {
            font-size: 1em; /* You can adjust the size if needed */
            font-weight: bold;
        }
        #loading-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw; /* Full viewport width */
            height: 100vh; /* Full viewport height */
            display: flex;
            justify-content: center; /* Centers horizontally */
            align-items: center; /* Centers vertically */
            background-color: rgba(255, 255, 255, 0.8); /* Optional: translucent background */
            z-index: 9999; /* Ensure it's on top of other content */
            flex-direction: column; /* Stack the image and text vertically */
            pointer-events: none;
        }

        #loading-animation img {
            width: 100px; /* Adjust image size */
            height: auto;
        }

        #loading-animation p {
            margin-top: 10px;
            font-size: 16px;
            color: #333;
            text-align: center;
        }
    </style>
</head>

<body>
    <!-- Header Section with Navigation Bar -->
    <div class="header">
        <div class="container">
            <nav class="navbar navbar-inverse" role="navigation">
                <div class="navbar-header">
                    <button type="button" id="nav-toggle" class="navbar-toggle" data-toggle="collapse" data-target="#main-nav">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span the class="icon-bar"></span>
                        <span the class="icon-bar"></span>
                    </button>
                    <a href="index.html" class="navbar-brand scroll-top">
                        <img src="img/logo.png" alt="EcoInsight Logo" style="height: 80px; margin-right: 10px;">
                    </a>
                </div>
                <div id="main-nav" class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="index.html" class="scroll-top">Home</a></li>
                        <li><a href="index.html#contact-us" class="scroll-link" data-id="contact-us">Our Mission</a></li>
                        <li><a href="index.html#about" class="scroll-link" data-id="about">Services</a></li>
                        <li><a href="#" id="clear-session-link">Emission Calculator</a></li>
                        <li><a href="recommendations.html">Recommendations</a></li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <div class="simulation-container">
        <div class="header-section">
            <h1>Eco Simulation</h1>
            <!-- Subtitle with dividers -->
            <div class="subtitle-container">
                <span class="subtitle-text">Adjust your lifestyle choices to see real-time changes in carbon emissions and cost savings.</span>
            </div>

            <!-- Prominent Apply and Reset buttons at the top -->
            <div class="button-section">
                <button class="reset-btn" onclick="resetChanges()">Reset</button>
            </div>

            <!-- Total CO2 Emissions Display -->
            <div class="total-emissions">
                <span id="total-emissions">Total CO2 Emissions: 0 kg</span>
            </div>
        </div>

        <div class="form-charts-container">
            <div class="form-section">
                <!-- Prominent Apply and Reset buttons at the top -->
                <div class="button-section">
                    <button onclick="toggleSection('energy-section')">Energy</button>
                    <button onclick="toggleSection('transport-section')">Transport</button>
                    <button onclick="toggleSection('appliance-section')">Appliance Use</button>
                </div>
                
                <!-- Energy Section (hidden by default) -->
                <div id="energy-section" class="form-section" style="display:none;">
                    <div class="subtitle-container">
                        <span class="subtitle-text">Energy</span>
                    </div>
                    <div class="form-group">
                        <label>Solar Panels:</label>
                        <div class="radio-option">
                            <input type="radio" id="solar-yes" name="solar-panels" value="yes">
                            <label for="solar-yes" class="btn-radio">Yes</label>
                            <input type="radio" id="solar-no" name="solar-panels" value="no">
                            <label for="solar-no" class="btn-radio">No</label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Gas Water Heater:</label>
                        <div class="radio-option">
                            <input type="radio" id="gas-yes" name="gas-water-heater" value="yes">
                            <label for="gas-yes" class="btn-radio">Yes</label>
                            <input type="radio" id="gas-no" name="gas-water-heater" value="no">
                            <label for="gas-no" class="btn-radio">No</label>
                        </div>
                    </div>
                </div>
                
                <!-- Transport Section (hidden by default) -->
                <div id="transport-section" class="form-section" style="display:none;">
                    <div class="subtitle-container">
                        <span class="subtitle-text">Transport</span>
                    </div>
                    <label for="car-distance">Car Commute (km/week):</label>
                    <input type="range" id="car-distance" class="slider" min="0" max="100" value="20" step="1" oninput="updateValue('car-distance', 'car-value')">
                    <div class="value-container">
                        <span id="car-value">20km</span>
                    </div>
                
                    <label for="train-distance">Train Commute (km/week):</label>
                    <input type="range" id="train-distance" class="slider" min="0" max="100" value="20" step="1" oninput="updateValue('train-distance', 'train-value')">
                    <div class="value-container">
                        <span id="train-value">20km</span>
                    </div>
                
                    <label for="bus-distance">Bus Commute (km/week):</label>
                    <input type="range" id="bus-distance" class="slider" min="0" max="100" value="20" step="1" oninput="updateValue('bus-distance', 'bus-value')">
                    <div class="value-container">
                        <span id="bus-value">20km</span>
                    </div>
                
                    <label for="tram-distance">Tram Commute (km/week):</label>
                    <input type="range" id="tram-distance" class="slider" min="0" max="100" value="20" step="1" oninput="updateValue('tram-distance', 'tram-value')">
                    <div class="value-container">
                        <span id="tram-value">20km</span>
                    </div>
                </div>
                
                <!-- Appliance Use Section (hidden by default) -->
                <div id="appliance-section" class="form-section" style="display:none;">
                    <div class="subtitle-container">
                        <span class="subtitle-text">Appliance</span>
                    </div>
                    <!-- Television Section -->
                    <h3 class="icon-text">
                        <span class="icon">
                            <img src="img/television.png" alt="Television Icon">
                        </span>
                        <span class="text">Television</span>
                    </h3>
                    <div class="form-group">
                        <label for="tv-screen-size">What screen size is your television?</label>
                        <select id="tv-screen-size" class="form-control" style="width: 500px;">
                            <option value="">--Select Size--</option>
                            <option value="Less than 40">Less than 40</option>
                            <option value="40 - 49">40 - 49</option>
                            <option value="50 - 59">50 - 59</option>
                            <option value="60 - 69">60 - 69</option>
                            <option value="70 - 79">70 - 79</option>
                            <option value="80 - 89">80 - 89</option>
                            <option value="90 - 99">90 - 99</option>
                            <option value="Greater than 100">Greater than 100</option>
                        </select>
                    </div>
                    <div class="form-group radio-question">
                        <label for="television-screen-tech">What screen technology does your television use?</label>
                        <div class="radio-option-group">
                            <div class="radio-option">
                                <input type="radio" id="tech-lcd" name="television-screen-tech" value="LCD" required>
                                <label for="tech-lcd" class="btn-radio">LCD</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="tech-plasma" name="television-screen-tech" value="Plasma" required>
                                <label for="tech-plasma" class="btn-radio">Plasma</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="tech-led" name="television-screen-tech" value="LED" required>
                                <label for="tech-led" class="btn-radio">LED</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="tech-oled" name="television-screen-tech" value="OLED" required>
                                <label for="tech-oled" class="btn-radio">OLED</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="television-hours">How many hours do you watch television a week?</label>
                        <input type="number" class="form-control" id="television-hours" name="television-hours" min="1" value="1" required>
                    </div>
                
                    <!-- Dishwasher Section -->
                    <h3 class="icon-text">
                        <span class="icon">
                            <img src="img/dishwasher.png" alt="Dishwasher Icon">
                        </span>
                        <span class="text">Dishwasher</span>
                    </h3>
                    <div class="form-group">
                        <label for="dishwasher-usage">How many times do you use the dishwasher a week?</label>
                        <input type="number" class="form-control" id="dishwasher-usage" name="dishwasher-usage" min="1" value="1" required>
                    </div>
                
                    <!-- Clothes Washer Section -->
                    <h3 class="icon-text">
                        <span class="icon">
                            <img src="img/clotheswasher.png" alt="Clotheswasher Icon">
                        </span>
                        <span class="text">Clothes Washer</span>
                    </h3>
                    <div class="form-group radio-question">
                        <label for="clothes-washer-loading">What type of loading is your clothes washer?</label>
                        <div class="radio-option-group">
                            <div class="radio-option">
                                <input type="radio" id="washer-loading-front" name="clothes-washer-loading" value="Front" required>
                                <label for="washer-loading-front" class="btn-radio">Front</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="washer-loading-top" name="clothes-washer-loading" value="Top" required>
                                <label for="washer-loading-top" class="btn-radio">Top</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clothes-washer-load-size">Clothes Washer Load Size (kg):</label>
                        <input type="range" id="clothes-washer-load-size" class="slider" min="2" max="19" value="10" step="1" oninput="updateClothesWasherValue()">
                        <div class="value-container">
                            <span id="clothes-washer-value">10 kg</span>
                        </div>
                    </div>                
                    <div class="form-group">
                        <label for="clothes-washer-usage">How many times do you use the clothes washer a week?</label>
                        <input type="number" class="form-control" id="clothes-washer-usage" name="clothes-washer-usage" min="1" value="1" required>
                    </div>
        
                    <!-- Clothes Dryer Section -->
                    <h3 class="icon-text">
                        <span class="icon">
                            <img src="img/clothesdryer.png" alt="Clothesdryer Icon">
                        </span>
                        <span class="text">Clothes Dryer</span>
                    </h3>
                    <div class="form-group radio-question">
                        <label for="clothes-dryer-type">What type of clothes dryer do you use?</label>
                        <div class="radio-option-group">
                            <div class="radio-option">
                                <input type="radio" id="dryer-type-vented" name="clothes-dryer-type" value="Vented" required>
                                <label for="dryer-type-vented" class="btn-radio">Vented</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="dryer-type-condenser" name="clothes-dryer-type" value="Condenser" required>
                                <label for="dryer-type-condenser" class="btn-radio">Condenser</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="clothes-dryer-usage">How many times do you use the clothes dryer a week?</label>
                        <input type="number" class="form-control" id="clothes-dryer-usage" name="clothes-dryer-usage" min="1" value="1" required>
                    </div>
        
                    <!-- Air Conditioner Section -->
                    <h3 class="icon-text">
                        <span class="icon">
                            <img src="img/air_conditioner.png" alt="Air Conditioner Icon">
                        </span>
                        <span class="text">Air Conditioner</span>
                    </h3>
                    <div class="form-group radio-question">
                        <label for="air-conditioner-type">Is your air conditioner ducted or non-ducted?</label>
                        <div class="radio-option-group">
                            <div class="radio-option">
                                <input type="radio" id="ac-type-ducted" name="air-conditioner-type" value="Ducted" required>
                                <label for="ac-type-ducted" class="btn-radio">Ducted</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ac-type-non-ducted" name="air-conditioner-type" value="Non Ducted" required>
                                <label for="ac-type-non-ducted" class="btn-radio">Non Ducted</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="ac-type-both" name="air-conditioner-type" value="Both" required>
                                <label for="ac-type-both" class="btn-radio">Both</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="air-conditioner-hours">How many hours do you use the air conditioner in a week?</label>
                        <input type="number" class="form-control" id="air-conditioner-hours" name="air-conditioner-hours" min="1" value="1" required>
                    </div>
                
                    <!-- Refrigerator Section -->
                    <h3 class="icon-text">
                        <span class="icon">
                            <img src="img/refrigerator.png" alt="Refrigerator Icon">
                        </span>
                        <span class="text">Refrigerator</span>
                    </h3>
                    <div class="form-group">
                        <label for="refrigerator-volume">What volume is your refrigerator?</label>
                        <select class="form-control" id="refrigerator-volume" name="refrigerator-volume" style="width: 500px;" required>
                            <option value="">--Select Volume--</option>
                            <option value="<99L">Less than 99L</option>
                            <option value="100-199L">100 - 199L</option>
                            <option value="200-299L">200 - 299L</option>
                            <option value="300-399L">300 - 399L</option>
                            <option value="400-499L">400 - 499L</option>
                            <option value="500-599L">500 - 599L</option>
                            <option value="600-699L">600 - 699L</option>
                            <option value=">700L">More than 700L</option>
                        </select>
                    </div>
                </div>
            </div>

        <div class="charts-section">
            <div class="chart-container">
                <div class="chart">
                    <h4>Emissions (Current vs Simulated)</h4>
                    <canvas id="emissionsChart"></canvas>
                </div>
                <div class="chart">
                    <h4>Cost (Current vs Simulated)</h4>
                    <canvas id="costChart"></canvas>
                </div>
            </div>
        </div>
    </div>

</div>
    <!-- Loading Animation with Tree GIF -->
    <div id="loading-animation" style="display: none;">
        <img src="img/tree.gif" alt="Loading...">
        <p>Calculating, please wait...</p>
    </div>
    

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>

    <script>

       // Function to scroll smoothly to the top
       function scrollToTop() {
            console.log("Back to Top button clicked!");
            window.scrollTo(0, 0);  // Scroll immediately to the top
        }


        // Show the "Back to Top" button after scrolling down 100px
        window.addEventListener('scroll', function() {
            const backToTopBtn = document.getElementById("backToTopBtn");
            const scrollPosition = window.pageYOffset || document.documentElement.scrollTop;

            console.log("Scroll Position:", scrollPosition);  // Debugging scroll position

            if (scrollPosition > 100) {  // Show after scrolling 100px
                backToTopBtn.style.display = "block";  // Show the button
                console.log("Showing Back to Top button");  // Debugging visibility
            } else {
                backToTopBtn.style.display = "none";  // Hide the button
                console.log("Hiding Back to Top button");  // Debugging hidden state
            }
        });


        // Toggles visibility of the section
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            if (section.style.display === 'none' || section.style.display === '') {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }
        function showSection(sectionId) {
            // Hide all sections first
            document.getElementById('energy-section').style.display = 'none';
            document.getElementById('transport-section').style.display = 'none';
            document.getElementById('appliance-section').style.display = 'none';
            
            // Show the clicked section
            document.getElementById(sectionId).style.display = 'block';
        }

        function updateClothesWasherValue() {
            const washerSlider = document.getElementById('clothes-washer-load-size');
            const washerValueDisplay = document.getElementById('clothes-washer-value');
            washerValueDisplay.textContent = `${washerSlider.value} kg`;
        }

        function updateValue(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const valueDisplay = document.getElementById(valueId);
            valueDisplay.textContent = `${slider.value} km`;
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Add event listeners to all input elements to update dynamically
            const formElements = document.querySelectorAll('input, select');

            formElements.forEach((element) => {
                element.addEventListener('input', applyChanges);  // for input changes
                element.addEventListener('change', applyChanges); // for selection changes
            });

            // Event listener for clearing session storage and restarting
            document.getElementById('clear-session-link').addEventListener('click', function (event) {
                event.preventDefault();
                sessionStorage.clear();
                console.log('SessionStorage cleared for Emission Calculator link.');
                window.location.href = "emission_cal_cover.html";
            });

            // Load the charts with stored data if available
            const storedData = sessionStorage.getItem('simulationData');
            if (storedData) {
                applyChanges();  // Apply the stored data to the form
            } else {
                resetChanges();  // Otherwise, reset the charts
            }
        });


        // Function to show the loading animation
        function showLoading() {
            document.getElementById('loading-animation').style.display = 'flex';  // Show the loading animation
        }

        // Function to hide the loading animation
        function hideLoading() {
            document.getElementById('loading-animation').style.display = 'none';   // Hide the loading animation
        }

        // Get references to input fields
        const solarPanels = document.getElementById('solar-panels');
        const gasWaterHeater = document.getElementById('gas-water-heater');

        const carDistance = document.getElementById('car-distance');
        const trainDistance = document.getElementById('train-distance');
        const busDistance = document.getElementById('bus-distance');
        const tramDistance = document.getElementById('tram-distance');

        const tvScreenSize = document.getElementById('tv-screen-size');
        const televisionHours = document.getElementById('television-hours');
        const dishwasherUsage = document.getElementById('dishwasher-usage');
        const washerUsage = document.getElementById('clothes-washer-usage');
        const dryerUsage = document.getElementById('clothes-dryer-usage');
        const acHours = document.getElementById('air-conditioner-hours');
        const refrigeratorVolume = document.getElementById('refrigerator-volume');
        const clothesWasherLoadSize = document.getElementById('clothes-washer-load-size'); 
    
        // Function to retrieve current emissions from sessionStorage
        // Function to retrieve current emissions from sessionStorage
        function getCurrentEmissions() {
            // Fetch the individual transport modes emissions
            const privateVehicleEmissions = parseFloat(sessionStorage.getItem('transportationData')?.private_vehicle || 0);
            const busEmissions = parseFloat(sessionStorage.getItem('transportationData')?.bus || 0);
            const trainEmissions = parseFloat(sessionStorage.getItem('transportationData')?.train || 0);
            const tramEmissions = parseFloat(sessionStorage.getItem('transportationData')?.tram || 0);

            // Calculate total transport emissions by summing up all the modes
            const totalTransportEmissions = privateVehicleEmissions + busEmissions + trainEmissions + tramEmissions;

            return {
                television: JSON.parse(sessionStorage.getItem('emissions_television'))?.appliance_emissions || 0,
                dishwasher: JSON.parse(sessionStorage.getItem('emissions_dishwasher'))?.appliance_emissions || 0,
                clothes_washer: JSON.parse(sessionStorage.getItem('emissions_clothes_washer'))?.appliance_emissions || 0,
                clothes_dryer: JSON.parse(sessionStorage.getItem('emissions_clothes_dryer'))?.appliance_emissions || 0,
                air_conditioner: JSON.parse(sessionStorage.getItem('emissions_air_conditioner'))?.appliance_emissions || 0,
                refrigerator: JSON.parse(sessionStorage.getItem('emissions_refrigerator'))?.appliance_emissions || 0,
                transport: totalTransportEmissions // Set total transport emissions
            };
        }


        // Function to retrieve the value of the selected radio button
        function getSelectedRadioValue(name) {
            const radios = document.getElementsByName(name);
            for (let radio of radios) {
                if (radio.checked) {
                    return radio.value;
                }
            }
            return null; // Return null if no selection is made
        }
    
        // Function to retrieve the value of the selected radio button
        function getSelectedRadioValue(name) {
            const radios = document.getElementsByName(name);
            for (let radio of radios) {
                if (radio.checked) {
                    return radio.value;
                }
            }
            return null; // Return null if no selection is made
        }

        async function sendDataToLambda(data) {
            showLoading();
            
            try {
                const response = await fetch('https://t5tau9uvbf.execute-api.ap-southeast-2.amazonaws.com/Eco/calculator', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)  // Send data as-is, no need for extra formatting
                });

                if (!response.ok) {
                    const errorDetails = await response.text();
                    console.error(`Response failed: Status ${response.status} - ${errorDetails}`);
                    throw new Error(`Failed to send data. Status ${response.status}`);
                }

                const results = await response.json();
                if (Array.isArray(results)) {
                    let totalEmissions = 0;
                    let simulatedEmissions = {};

                    // Iterate over the array of responses
                    results.forEach(result => {
                        const resultBody = JSON.parse(result.body);
                        
                        // Aggregate emissions
                        totalEmissions += resultBody.appliance_emissions || resultBody.transport_emissions || 0;
                        
                        // Aggregate individual emissions
                        if (resultBody.individual_appliance_emissions) {
                            Object.assign(simulatedEmissions, resultBody.individual_appliance_emissions);
                        }
                        if (resultBody.individual_transport_emissions) {
                            Object.assign(simulatedEmissions, resultBody.individual_transport_emissions);
                        }
                    });

                    // Update the total CO2 emissions
                    document.getElementById('total-emissions').innerText = `Total CO2 Emissions: ${totalEmissions.toFixed(2)} kg`;
                    

                    console.log("Simulated Emissions Data:", simulatedEmissions);
                    console.log("Lambda Response:", results);


                    // Update the charts with the simulated emissions data
                    updateCharts(simulatedEmissions);
                } else {
                    console.error("Error in the Lambda response:", results);
                }

            } catch (error) {
                console.error('Error sending data to Lambda:', error);
                alert('There was an error submitting your data. Please try again.');
            } finally {
                hideLoading();
            }
        }



        function applyChanges() {
            let requests = [];

            // Process Solar Panel Data
            const solarPanelVal = getSelectedRadioValue('solar-panels');
            const gridDependenceVal = 100; // Assuming this as a default grid dependence percentage for now
            if (solarPanelVal) {
                requests.push({
                    type: 'solar',  // Add type field for solar
                    solar_panels: solarPanelVal,
                    grid_dependence: gridDependenceVal
                });
            }

            // Process Television Data
            const tvScreenSizeVal = tvScreenSize.value || null;
            const tvScreenTech = getSelectedRadioValue('television-screen-tech') || null;
            const tvHours = televisionHours.value ? parseFloat(televisionHours.value) : 0;
            console.log("Television Input:", tvScreenSizeVal, tvScreenTech, tvHours);


            if (tvScreenSizeVal && tvScreenTech && tvHours > 0) {
                requests.push({
                    type: 'appliance',  // Add type field
                    appliance_type: 'television',
                    screen_size_category: tvScreenSizeVal,
                    screen_technology: tvScreenTech,
                    hours: tvHours
                });
            }

            // Process Dishwasher Data
            const dishwasherUsageVal = dishwasherUsage.value ? parseFloat(dishwasherUsage.value) : 0;
            if (dishwasherUsageVal > 0) {
                requests.push({
                    type: 'appliance',  // Add type field
                    appliance_type: 'dishwasher',
                    usage_per_week: dishwasherUsageVal
                });
            }

            // Process Clothes Washer Data
            const washerLoadingType = getSelectedRadioValue('clothes-washer-loading') || null;
            const washerLoadSizeVal = clothesWasherLoadSize.value ? parseFloat(clothesWasherLoadSize.value) : 0;
            const washerUsageVal = washerUsage.value ? parseFloat(washerUsage.value) : 0;

            if (washerLoadingType && washerLoadSizeVal > 0 && washerUsageVal > 0) {
                requests.push({
                    type: 'appliance',  // Add type field
                    appliance_type: 'clothes_washer',
                    Loading: washerLoadingType,
                    Cap: washerLoadSizeVal,
                    usage_per_week: washerUsageVal
                });
            }

            // Process Clothes Dryer Data
            const dryerType = getSelectedRadioValue('clothes-dryer-type') || null;
            const dryerUsageValue = dryerUsage.value ? parseFloat(dryerUsage.value) : 0;
            if (dryerType && dryerUsageValue > 0) {
                requests.push({
                    type: 'appliance',  // Add type field
                    appliance_type: 'clothes_dryer',
                    Type: dryerType,
                    usage_per_week: dryerUsageValue
                });
            }

            // Process Air Conditioner Data
            const acType = getSelectedRadioValue('air-conditioner-type') || null;
            const acHoursVal = acHours.value ? parseFloat(acHours.value) : 0;
            if (acType && acHoursVal > 0) {
                requests.push({
                    type: 'appliance',  // Add type field
                    appliance_type: 'air_conditioner',
                    Configuration1: acType,
                    hours_per_day: acHoursVal
                });
            }

            // Process Refrigerator Data
            const refrigeratorVolumeVal = refrigeratorVolume.value || null;
            if (refrigeratorVolumeVal) {
                requests.push({
                    type: 'appliance',  // Add type field
                    appliance_type: 'refrigerator',
                    volume_category: refrigeratorVolumeVal
                });
            }

            // Process Gas Water Heater Data
            const gasWaterHeaterVal = getSelectedRadioValue('gas-water-heater');
            if (gasWaterHeaterVal) {
                requests.push({
                    type: 'gas',  // Add type field for gas water heater
                    heater_type: gasWaterHeaterVal === 'yes' ? 'instantaneous' : 'none'
                });
            }

            // Process Transportation Data
            const transportationData = [
                { type: 'transportation', transportation_type: 'bus', kms: busDistance.value ? parseFloat(busDistance.value) : 0 },
                { type: 'transportation', transportation_type: 'private_vehicle', kms: carDistance.value ? parseFloat(carDistance.value) : 0 },
                { type: 'transportation', transportation_type: 'train', kms: trainDistance.value ? parseFloat(trainDistance.value) : 0 },
                { type: 'transportation', transportation_type: 'tram', kms: tramDistance.value ? parseFloat(tramDistance.value) : 0 }
            ];

            // Add transportation data to the request
            requests.push(...transportationData);

            // Send the combined requests to the Lambda function
            sendDataToLambda(requests);
        }

        let emissionsChartInstance = null;
        let costChartInstance = null;

        // Function to update emissions and cost charts
        function updateCharts(simulatedEmissions) {
            const currentEmissions = getCurrentEmissions();

            // Define the categories for the emissions chart
            const categories = ['Television', 'Dishwasher', 'Washer', 'Dryer', 'Air Conditioner', 'Transport'];

            // Combine transportation emissions into one value for both current and simulated data
            const simulatedTransportEmissions = (simulatedEmissions?.bus || 0) + 
                                                (simulatedEmissions?.private_vehicle || 0) + 
                                                (simulatedEmissions?.train || 0) + 
                                                (simulatedEmissions?.tram || 0);

            const currentTransportEmissions = (currentEmissions.bus || 0) + 
                                            (currentEmissions.private_vehicle || 0) + 
                                            (currentEmissions.train || 0) + 
                                            (currentEmissions.tram || 0);

            // Use default values (0) if any of the properties in simulatedEmissions are undefined
            const simulatedEmissionsArray = [
                simulatedEmissions?.television || 0, 
                simulatedEmissions?.dishwasher || 0, 
                simulatedEmissions?.clothes_washer || 0, 
                simulatedEmissions?.clothes_dryer || 0, 
                simulatedEmissions?.air_conditioner || 0, 
                simulatedTransportEmissions // Combine transport emissions
            ];

            const currentEmissionsArray = [
                currentEmissions.television || 0, 
                currentEmissions.dishwasher || 0, 
                currentEmissions.clothes_washer || 0, 
                currentEmissions.clothes_dryer || 0, 
                currentEmissions.air_conditioner || 0, 
                currentTransportEmissions // Combine transport emissions
            ];

            // Calculate the energy cost per unit
            const energyCostPerUnit = 0.1901; // cost per unit of energy
            const currentCosts = currentEmissionsArray.map(e => e * energyCostPerUnit);
            const simulatedCosts = simulatedEmissionsArray.map(e => e * energyCostPerUnit);
            console.log("Simulated Emissions Array:", simulatedEmissionsArray);
            console.log("Current Emissions Array:", currentEmissionsArray);


            // Destroy previous chart instances if they exist
            if (emissionsChartInstance) emissionsChartInstance.destroy();
            if (costChartInstance) costChartInstance.destroy();

            // Create the emissions chart
            emissionsChartInstance = new Chart(document.getElementById('emissionsChart'), {
                type: 'bar',
                data: {
                    labels: categories,
                    datasets: [
                        { label: 'Current Emissions', data: currentEmissionsArray, backgroundColor: 'rgba(54, 162, 235, 0.5)' },
                        { label: 'Simulated Emissions', data: simulatedEmissionsArray, backgroundColor: 'rgba(255, 99, 132, 0.5)' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            bottom: 60
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                autoSkip: false,
                                maxRotation: 0, // Ensures no label rotation
                                minRotation: 0 // Ensures no label rotation
                            }
                        },
                        y: { 
                            beginAtZero: true 
                        }
                    },
                    plugins: {
                        datalabels: {
                            anchor: 'end',
                            align: 'start',
                            offset: -20, 
                            formatter: function(value) {
                                return typeof value === 'number' && !isNaN(value) ? value.toFixed(2) : ''; 
                            },
                            color: '#444', // Color of the labels
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });

            // Create the cost chart
            costChartInstance = new Chart(document.getElementById('costChart'), {
                type: 'line',
                data: {
                    labels: categories,
                    datasets: [
                        { label: 'Current Cost', data: currentCosts, backgroundColor: 'rgba(54, 235, 162, 0.5)' },
                        { label: 'Simulated Cost', data: simulatedCosts, backgroundColor: 'rgba(255, 99, 132, 0.5)' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,  // Allows custom sizing
                    layout: {
                        padding: {
                            bottom: 60
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                autoSkip: false,
                                maxRotation: 0, // Ensures no label rotation
                                minRotation: 0 // Ensures no label rotation
                            }
                        },
                        y: { 
                            beginAtZero: true 
                        }
                    },
                    plugins: {
                        datalabels: {
                            anchor: 'end',
                            align: 'start',
                            offset: -20, 
                            formatter: function(value) {
                                return typeof value === 'number' && !isNaN(value) ? `$${value.toFixed(2)}` : ''; 
                            },
                            color: '#444', // Color of the labels
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                },
                plugins: [ChartDataLabels]
            });
        }



        // Reset function to clear session storage and reset charts
        function resetChanges() {
            sessionStorage.removeItem('simulationData');
            updateCharts({});  // Empty data for charts
            document.getElementById('total-emissions').innerText = 'Total CO2 Emissions: 0 kg';
        }
    
        // Load existing data from session storage on page load
        window.onload = function () {
            const storedData = sessionStorage.getItem('simulationData');
            if (storedData) {
                applyChanges();
            } else {
                resetChanges();
            }
        };
</script>
</body>
</html>